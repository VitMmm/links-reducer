# –î–µ–ø–ª–æ–π –Ω–∞ Fly.io + GitHub

Fly.io - —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Node.js, PostgreSQL –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Fly.io

- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π HTTPS
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–µ—Ç—å (–Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã—Ö —Ç–æ–º–æ–≤ –¥–ª—è SQLite

## –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Fly CLI

### macOS (Homebrew):
```bash
brew install flyctl
```

### macOS / Linux (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç):
```bash
curl -L https://fly.io/install.sh | sh
```
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ PATH (—Å–∫—Ä–∏–ø—Ç –æ–±—ã—á–Ω–æ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç):
```bash
export FLYCTL_INSTALL="/Users/–≤–∞—à-username/.fly"
export PATH="$FLYCTL_INSTALL/bin:$PATH"
```
–ò–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª.

### macOS / Linux (–µ—Å–ª–∏ curl –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):
–°–∫–∞—á–∞–π—Ç–µ –±–∏–Ω–∞—Ä–Ω–∏–∫ –≤—Ä—É—á–Ω—É—é —Å [GitHub Releases](https://github.com/superfly/flyctl/releases):
- –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é –¥–ª—è –≤–∞—à–µ–π –û–° (darwin_amd64, darwin_arm64, linux_amd64 –∏ —Ç.–¥.)
- –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∏ –ø–æ–ª–æ–∂–∏—Ç–µ `flyctl` –≤ –∫–∞—Ç–∞–ª–æ–≥ –∏–∑ PATH, –Ω–∞–ø—Ä–∏–º–µ—Ä:
  ```bash
  sudo mv flyctl /usr/local/bin/
  chmod +x /usr/local/bin/flyctl
  ```

### Windows:
```powershell
powershell -Command "iwr https://fly.io/install.ps1 -useb | iex"
```
–ò–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å [fly.io/docs/hands-on/install-flyctl/](https://fly.io/docs/hands-on/install-flyctl/)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
flyctl version
```
–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–∞—Ç–∞–ª–æ–≥ —Å `flyctl` –¥–æ–±–∞–≤–ª–µ–Ω –≤ PATH.

## –®–∞–≥ 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥

```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–æ—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä)
flyctl auth signup

# –ò–ª–∏ –≤—Ö–æ–¥, –µ—Å–ª–∏ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
flyctl auth login
```

## –®–∞–≥ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
flyctl launch
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç `fly.toml` (—É–∂–µ —Å–æ–∑–¥–∞–Ω –≤ –ø—Ä–æ–µ–∫—Ç–µ) –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç:
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ: `reducer-link`)
- –†–µ–≥–∏–æ–Ω (–≤—ã–±–µ—Ä–∏—Ç–µ –±–ª–∏–∂–∞–π—à–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä `iad` –¥–ª—è –°–®–ê –∏–ª–∏ `fra` –¥–ª—è –ï–≤—Ä–æ–ø—ã)
- –°–æ–∑–¥–∞—Ç—å PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º SQLite)

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ç–æ–º–∞ –¥–ª—è SQLite

–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–æ–º:

```bash
# –°–æ–∑–¥–∞–µ–º —Ç–æ–º —Ä–∞–∑–º–µ—Ä–æ–º 1GB
flyctl volumes create reducer_data --size 1 --region iad
```

–û–±–Ω–æ–≤–∏—Ç–µ `fly.toml`, –¥–æ–±–∞–≤–∏–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–æ–º–∞:

```toml
[[mounts]]
  source = "reducer_data"
  destination = "/data"
```

–ò –æ–±–Ω–æ–≤–∏—Ç–µ `server.js` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—É—Ç–∏ `/data/links.db`:

```javascript
const dbPath = process.env.DATABASE_PATH || '/data/links.db';
```

## –®–∞–≥ 5: –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

```bash
# –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
flyctl deploy

# –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
flyctl open
```

## –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

### 6.1. –ü–æ–ª—É—á–∏—Ç–µ Fly.io —Ç–æ–∫–µ–Ω

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω
flyctl tokens create deploy -x 999999h
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (–æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è GitHub Secrets).

### 6.2. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ GitHub Secrets

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Secrets and variables ‚Üí Actions
3. –ù–∞–∂–º–∏—Ç–µ "New repository secret"
4. Name: `FLY_API_TOKEN`
5. Value: –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ —à–∞–≥–∞ 6.1
6. –ù–∞–∂–º–∏—Ç–µ "Add secret"

### 6.3. –ü–æ–ª—É—á–∏—Ç–µ App Name

–í —Ñ–∞–π–ª–µ `fly.toml` –Ω–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É `app = "reducer-link"` (–∏–ª–∏ –≤–∞—à–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è).

### 6.4. –°–æ–∑–¥–∞–π—Ç–µ GitHub Actions workflow

–§–∞–π–ª `.github/workflows/fly-deploy.yml` —É–∂–µ —Å–æ–∑–¥–∞–Ω –≤ –ø—Ä–æ–µ–∫—Ç–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é:

```yaml
name: Fly Deploy

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy app
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: superfly/flyctl-actions/setup-flyctl@master
      
      - run: flyctl deploy --remote-only
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
```

## –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –ø—É—à–∞ –≤ `main`/`master`:

1. GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç –¥–µ–ø–ª–æ–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ —Ä–∞–∑–¥–µ–ª–µ "Actions" –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   flyctl open
   ```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Fly.io

```bash
# –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
flyctl status

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
flyctl logs

# SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –º–∞—à–∏–Ω–µ
flyctl ssh console

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (–∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—à–∏–Ω)
flyctl scale count 1

# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
flyctl metrics

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
flyctl restart

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
flyctl secrets list

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
flyctl secrets set DATABASE_PATH=/data/links.db

# –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
flyctl apps destroy reducer-link
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞:

1. –î–æ–±–∞–≤—å—Ç–µ DNS –∑–∞–ø–∏—Å—å:
   ```
   Type: CNAME
   Name: @ (–∏–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω)
   Value: reducer-link.fly.dev
   ```

2. –í Fly.io:
   ```bash
   flyctl certs create yourdomain.com
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:
   ```bash
   flyctl certs show yourdomain.com
   ```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

```bash
# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
flyctl logs

# –õ–æ–≥–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
flyctl logs --app reducer-link

# –ú–µ—Ç—Ä–∏–∫–∏
flyctl metrics
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ push –≤ `main`/`master` - GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç:

```bash
git add .
git commit -m "Update app"
git push origin main
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
flyctl deploy
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
flyctl secrets set KEY=value

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ
flyctl secrets set KEY1=value1 KEY2=value2

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö
flyctl secrets list

# –£–¥–∞–ª–∏—Ç—å
flyctl secrets unset KEY
```

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–ª—è SQLite –Ω–∞ Fly.io:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –º–∞—à–∏–Ω–µ
flyctl ssh console

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
# (–≤–Ω—É—Ç—Ä–∏ SSH —Å–µ—Å—Å–∏–∏)
cp /data/links.db /tmp/links_backup.db

# –í—ã–π–¥–∏—Ç–µ –∏–∑ SSH –∏ —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª
flyctl ssh sftp get /tmp/links_backup.db ./links_backup.db
```

–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±—ç–∫–∞–ø–∞ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ cron –Ω–∞ Fly.io).

## Troubleshooting

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
flyctl logs

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
flyctl status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
flyctl config show
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω
flyctl volumes list

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ–º–∞ –≤ fly.toml
flyctl config show
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–µ–ø–ª–æ–µ–º:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dockerfile
flyctl deploy --verbose

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ
docker build -t reducer-test .
docker run -p 3000:3000 reducer-test
```

## –°—Ç–æ–∏–º–æ—Å—Ç—å

Fly.io –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:
- 3 shared-cpu-1x VMs (256MB RAM –∫–∞–∂–¥–∞—è)
- 3GB –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- 160GB –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –º–µ—Å—è—Ü

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [fly.io/docs/about/pricing/](https://fly.io/docs/about/pricing/)

## –ì–æ—Ç–æ–≤–æ! üéâ

–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ Fly.io –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—É—à–µ –≤ GitHub!

**URL –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** `https://reducer-link.fly.dev` (–∏–ª–∏ –≤–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–æ–º–µ–Ω)
